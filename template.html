<html class="debug">
	<head>
		<meta charset="utf-8">
		<title>Overlay from ${process.argv[2].replace(/</g, '&lt;')}</title>
		<style>
			body {
				margin: 0;
			}
			svg {
				max-width: 100vw;
				max-height: 100vh;
				margin: auto;
			}
			.debug body {
				background: red;
			}
			.debug svg {
				background: white;
			}
		</style>
	</head>
	<body>
		OVERLAY_SVG_GOES_HERE
		<script>
			let texts = document.querySelectorAll('text');

			let placeholders = [];
			let placeholderOptions = new Map();

			for (const text of texts) {
				if (!text.textContent.match(/^[#\s]+$/)) {
					continue;
				}

				placeholders.push(text);
				placeholderOptions.set(text, {
					horizontalAlign: 'center',
				});
			}

			function updateText(el, newText) {
				if (!placeholderOptions.has(el)) {
					throw new Error('element is not a placeholder');
				}
				let {
					horizontalAlign,
				} = placeholderOptions.get(el);

				let oldRect = el.getBBox();

				el.textContent = newText;
				let newRect = el.getBBox();

				let horizontalOffset;
				if (horizontalAlign == 'center') {
					horizontalOffset = (oldRect.width - newRect.width) / 2;
				} else if (horizontalAlign == 'right') {
					horizontalOffset = oldRect.width - newRect.width;
				} else { // left or unknown
					horizontalOffset = 0;
				}

				let currentTransform = el.getAttribute('transform');
				let newTransform = currentTransform.replace(/matrix\(1 0 0 1 ([\d\.]+) ([\d\.]+)\)/, (_, x, y) => `matrix(1 0 0 1 ${parseFloat(x) + horizontalOffset} ${parseFloat(y)})`);
				el.setAttribute('transform', newTransform)
			}

			let strings = [
				'Hello, world!',
				'Hi',
				'foo bar test this string is much longer than the other strings',
				'Lorem ipsum',
				'is this thing on?',
				'&)(*@#^&%&*)(*$&#)(*^&)(#*@&$',
				'would you look at that',
			];
			setInterval(() => {
				for (const el of placeholders) {
					updateText(el, strings[~~(Math.random() * strings.length)]);
				}
			}, 1000);
		</script>
	</body>
</html>
